<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shuttle Bus Tracker</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,300..900;1,300..900&display=swap');

    html {
      font-family: sans-serif;
      line-height: 1.2;
      -webkit-text-size-adjust: 100%;
      -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
    }

    body {
      margin: 0;
      padding: 0;
      font-family: "Rubik", serif;
      font-weight: normal;
      line-height: 1.2;
      color: #2F314D !important;
      background-color: #F8F4EE;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    h1, h2, h3, h4, h5, h6,
    .h1, .h2, .h3, .h4, .h5, .h6 {
      color: #2F314D;
    }

    button.navbar-toggler {
      padding: 0.25rem;
      border: 0;
    }

    button.navbar-toggler i.bi {
      color: #FF9859;
      font-size: 2rem;
      -webkit-text-stroke-width: 1px;
    }

    .app-status {
      position: relative;
      top: -1rem;
      font-size: 0.8rem;
    }

    .navbar-nav .nav-item {
      text-align: center;
      padding: 0.5rem 0;
    }

    .text-red {
      color: #EA5C4F;
    }

    .text-orange {
      color: #FF9859;
    }

    .rotate180 {
      transform: rotate(180deg);
      margin-top: 0.1rem;
    }

    .navbar {
      background-color: #2F314D;
      color: #FAFAFA;
    }

    .navbar-brand {
      font-size: 1.5rem;
      font-weight: bold;
    }

    header {
      background-color: #EECBB2;
      border-bottom-left-radius: 2rem;
      border-bottom-right-radius: 2rem;
    }

    .title-panel {
      display: inline-flex;
      justify-content: center;
      align-items: center;
      padding: 1rem 5rem;
      border-radius: 1.2rem;
      font-size: 1.4rem;
      background-color: #EECBB3;
    }

    .title-panel.attention {
      background-color: #FECE85;
    }

    .title-panel .bi {
      font-size: 2rem;
      margin-right: 0.5rem;
    }

    .status-panel {
      width: 100%;
      display: inline-flex;
      justify-content: center;
      align-items: center;
      position: relative;
      padding: 1rem 1.8rem;
      border-radius: 1.2rem;
      font-size: 1.4rem;
      background-color: #F4F0EC;
      margin: 0 auto;
      box-shadow: 0 0.6rem 0 0 #ACACAC;
      z-index: 2;
    }

    .status-indicator {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 8px;
    }

    .status-on {
      background-color: #92BA79;
      border: 2px solid #729B58;
    }

    .status-off {
      background-color: #E95C50;
      border: 2px solid #D83B2E;
    }

    .status-unknown {
      background-color: #FECE85;
      border: 2px solid #FFB646;
    }

    .station-container {
      position: relative;
      height: 8rem;
      padding: 20px 0;
    }

    .station-marker {
      width: 30px;
      height: 30px;
      min-width: 30px;
      min-height: 30px;
      border-radius: 50%;
      background-color: #FAFAFA;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #FF9966;
      border: 5px solid #F96;
      position: relative;
      z-index: 2;
    }

    .station-connector {
      position: absolute;
      left: 10px;
      top: 45px;
      width: 2px;
      height: calc(100% - 21px);
      border-left: 10px dotted #ccc;
      z-index: 1;
    }

    .bus-icon {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      color: #92BA79;
      font-size: 2rem;
      margin: 10px 0;
      position: relative;
    }

    .bus-icon svg {
      -webkit-transform: scaleX(-1);
      transform: scaleX(-1);
    }

    .bus-number {
      position: absolute;
      top: -8px;
      right: -4px;
      background: #2F314D;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 1rem;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .animated-hover {
      animation-name: moving-3s;
      animation-duration: 2s;
      animation-iteration-count: infinite;
      animation-timing-function: ease-in-out;
    }

    @keyframes moving-3s {
      0% {
        transform: translate(0, 5px);
      }

      50% {
        transform: translate(0, -5px);
      }

      100% {
        transform: translate(0, 5px);
      }
    }

    .animated-blink {
      animation-name: blink-1s;
      animation-duration: 1s;
      animation-iteration-count: infinite;
      animation-timing-function: ease-in-out;
    }

    @keyframes blink-1s {
      0% {
        opacity: 1;
      }

      30% {
        opacity: 0;
      }

      100% {
        opacity: 1;
      }
    }

    .timetable-divider {
      border-left: 3px solid #CCCCCC;
    }

    .horizontal-divider {
      border-bottom: 3px solid #CCCCCC;
    }

    .journey-time {
      font-size: 2.5rem;
      font-weight: bold;
    }

    .service-times {
      display: grid;
      grid-template-columns: auto auto;
      gap: 10px;
    }

    .last-bus-times {
      display: grid;
      grid-template-columns: auto auto;
      gap: 10px;
    }

    .require-attention {
      color: #E95C50;
    }

    .bg-footer {
      height: 35rem;
      background-image: url('../imgs/bg_footer_m.png');
      background-size: 100%;
      background-repeat: no-repeat;
      background-position: bottom;
    }

    .img-bee {
      width: 22rem;
    }

    @media (min-width: 576px) {
      .bg-footer {
        height: 20rem;
        background-image: url('../imgs/bg_footer_d.png');
      }

      .img-bee {
        width: 26rem;
      }
    }

    .route-selector {
      background-color: #EECBB2;
      padding: 15px;
      border-radius: 15px;
      margin-bottom: 20px;
    }

    .route-btn {
      border: 2px solid #2F314D;
      background-color: #F8F4EE;
      color: #2F314D;
      margin: 5px;
      transition: all 0.3s;
    }

    .route-btn.active {
      background-color: #2F314D;
      color: #F8F4EE;
    }

    .route-info {
      background-color: #F4F0EC;
      padding: 10px;
      border-radius: 10px;
      margin-top: 10px;
      font-size: 0.9rem;
    }
  </style>

</head>

<body>
  <!-- Navigation Bar -->
  <nav class="navbar">
    <div class="container-fluid">
      <a class="navbar-brand text-light" href="#">
        <i class="bi bi-bus-front me-2"></i>Shuttle Bus Tracker
      </a>
      <div class="text-light" id="current-time">00:00:00</div>
    </div>
  </nav>

  <!-- 主要動態時間表 -->
  <div class="container main-timetable py-4">
    <div class="row">
      <div class="col-6">
        <!-- 左側：站點和巴士位置顯示 -->
        <div class="stops-container" id="stops-container">
          <!-- Stations will be dynamically generated here -->
        </div>
      </div>
      <div class="col-6 timetable-divider">
        <!-- 右側：路線資訊和時刻表 -->
        <div class="journey-info py-3 mb-4">
          <h3 class="mb-0">Bus Frequency</h3>
          <p class="mb-0">Approx.</p>
          <div class="journey-time"><span id="frequency">10</span> <span class="fs-5">mins</span></div>

          <h3 class="mt-4">Service Time</h3>
          <div class="service-times" id="service-times">
            <!-- Service times will be inserted here -->
          </div>

          <h3 class="mt-4">Last Bus</h3>
          <div class="last-bus-times" id="last-bus-times">
            <!-- Last bus times will be inserted here -->
          </div>
        </div>
      </div>
      <div class="col-12 pt-4">
        <div class="schedule-container">
          <div class="schedule-table">
            <h4 id="schedule-title">Schedule</h4>
            <div class="table-responsive">
              <table class="table table-striped table-bordered table-sm">
                <thead class="table-dark align-middle">
                  <tr id="schedule-header">
                    <!-- Table headers will be inserted here -->
                  </tr>
                </thead>
                <tbody id="schedule-body">
                  <!-- Schedule rows will be inserted here -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // Route Configuration Data
    const routeConfig = {
      morning: {
        name: "Morning Route",
        operatingHours: "07:30-10:00",
        stops: ["Buona Vista MRT", "one-north MRT", "Campus"],
        busFrequency: 20,
        buses: 1,
        schedule: [
          { id: 1, times: ["07:30", "07:35", "07:40"] },
          { id: 2, times: ["07:50", "07:55", "08:00"] },
          { id: 3, times: ["08:10", "08:15", "08:20"] },
          { id: 4, times: ["08:30", "08:35", "08:40"] },
          { id: 5, times: ["08:50", "08:55", "09:00"] },
          { id: 6, times: ["09:10", "09:15", "09:20"] },
          { id: 7, times: ["09:30", "09:35", "09:40"] },
          { id: 8, times: ["09:50", "09:55", "10:00"] },
        ],
        lastBus: "09:55",
        description: "Buona Vista MRT → one-north MRT → Campus"
      },
      lunchMWF: {
        name: "Lunch Route (Mon/Wed/Fri)",
        operatingHours: "11:30-14:00",
        stops: ["Campus", "Holland Drive Food Centre", "Ghim Moh Food Centre"],
        busFrequency: 30,
        buses: 1,
        schedule: [
          { id: 1, times: ["11:30", "11:40", "11:45"] },
          { id: 2, times: ["12:00", "12:10", "12:15"] },
          { id: 3, times: ["12:30", "12:40", "12:45"] },
          { id: 4, times: ["13:00", "13:10", "13:15"] },
          { id: 5, times: ["13:30", "13:40", "13:45"] },
        ],
        lastBus: "13:45",
        description: "Campus → Holland Drive Food Centre → Ghim Moh Food Centre"
      },
      lunchTT: {
        name: "Lunch Route (Tue/Thu)",
        operatingHours: "11:30-14:00",
        stops: ["Campus", "one-north MRT", "The Star Vista"],
        busFrequency: 20,
        buses: 1,
        schedule: [
          { id: 1, times: ["11:30", "11:35", "11:40"] },
          { id: 2, times: ["11:50", "11:55", "12:00"] },
          { id: 3, times: ["12:10", "12:15", "12:20"] },
          { id: 4, times: ["12:30", "12:35", "12:40"] },
          { id: 5, times: ["12:50", "12:55", "13:00"] },
          { id: 6, times: ["13:10", "13:15", "13:20"] },
          { id: 7, times: ["13:30", "13:35", "13:40"] },
          { id: 8, times: ["13:50", "13:55", "14:00"] },
        ],
        lastBus: "14:00",
        description: "Campus → one-north MRT → The Star Vista"
      },
      evening: {
        name: "Evening Route",
        operatingHours: "17:00-19:30",
        stops: ["Campus", "one-north MRT", "Buona Vista MRT"],
        busFrequency: 10,
        buses: 2,
        schedule: [
          { id: 1, bus: 1, times: ["17:00", "17:05", "17:10"] },
          { id: 1, bus: 2, times: ["17:10", "17:15", "17:20"] },
          { id: 2, bus: 1, times: ["17:20", "17:25", "17:30"] },
          { id: 2, bus: 2, times: ["17:30", "17:35", "17:40"] },
          { id: 3, bus: 1, times: ["17:40", "17:45", "17:50"] },
          { id: 3, bus: 2, times: ["17:50", "17:55", "18:00"] },
          { id: 4, bus: 1, times: ["18:00", "18:05", "18:10"] },
          { id: 4, bus: 2, times: ["18:10", "18:15", "18:20"] },
          { id: 5, bus: 1, times: ["18:20", "18:25", "18:30"] },
          { id: 5, bus: 2, times: ["18:30", "18:35", "18:40"] },
          { id: 6, bus: 1, times: ["18:40", "18:45", "18:50"] },
          { id: 6, bus: 2, times: ["18:50", "18:55", "19:00"] },
          { id: 7, bus: 1, times: ["19:00", "19:05", "19:10"] },
          { id: 7, bus: 2, times: ["19:10", "19:15", "19:20"] },
          { id: 8, bus: 1, times: ["19:20", "19:25", "19:30"] },
        ],
        lastBus: {
          bus1: "19:20",
          bus2: "19:10",
        },
        description: "Campus → one-north MRT → Buona Vista MRT"
      },
    };

    // Global variables
    let currentRoute = 'evening';
    let clock;

    // Initialize the app
    document.addEventListener('DOMContentLoaded', function () {
      // Set up route buttons
      setupRouteButtons();

      // Start the clock
      startClock();

      // Load the default route (evening)
      loadRouteBasedOnTime()

      // Start the bus simulation
      simulateBusMovement();
    });

    function loadRouteBasedOnTime() {
      const now = new Date();
      const hours = now.getHours();
      const minutes = now.getMinutes();
      const day = now.getDay(); // 0 是星期日, 1-5 是星期一到星期五

      // 將時間轉換為分鐘，方便比較
      const currentTimeInMinutes = hours * 60 + minutes;

      // 早上路線時間範圍: 7:30-10:00
      const morningStart = 7 * 60 + 30;
      const morningEnd = 10 * 60;

      // 午餐路線時間範圍: 11:30-14:00
      const lunchStart = 11 * 60 + 30;
      const lunchEnd = 14 * 60;

      // 傍晚路線時間範圍: 17:00-19:30
      const eveningStart = 17 * 60;
      const eveningEnd = 19 * 60 + 30;

      // 根據時間和星期幾決定當前路線
      let routeToLoad;

      if (currentTimeInMinutes >= morningStart && currentTimeInMinutes <= morningEnd) {
        routeToLoad = 'morning';
      } else if (currentTimeInMinutes >= lunchStart && currentTimeInMinutes <= lunchEnd) {
        // 星期一、三、五 (1, 3, 5) 用 lunchMWF 路線
        if (day === 1 || day === 3 || day === 5) {
          routeToLoad = 'lunchMWF';
        } else if (day === 2 || day === 4) { // 星期二、四 (2, 4) 用 lunchTT 路線
          routeToLoad = 'lunchTT';
        } else {
          // 週末沒有午餐路線，顯示早上路線作為默認
          routeToLoad = 'morning';
        }
      } else if (currentTimeInMinutes >= eveningStart && currentTimeInMinutes <= eveningEnd) {
        routeToLoad = 'evening';
      } else {
        // 不在任何服務時間段，默認顯示早上路線
        routeToLoad = 'morning';
      }

      // 載入選定的路線
      loadRoute(routeToLoad);

      // 修改 updateClock 函數，讓它每分鐘檢查一次是否需要切換路線
      // (這部分在下面的 updateClock 修改中處理)
    }

    // Function to set up route buttons
    function setupRouteButtons() {
      const routeButtons = document.querySelectorAll('.route-btn');
      routeButtons.forEach(button => {
        button.addEventListener('click', function () {
          // Remove active class from all buttons
          routeButtons.forEach(btn => btn.classList.remove('active'));

          // Add active class to clicked button
          this.classList.add('active');

          // Load the selected route
          const routeName = this.getAttribute('data-route');
          loadRoute(routeName);
        });
      });
    }

    // Function to start the clock
    function startClock() {
      // Update the clock every second
      setInterval(updateClock, 1000);

      // Initial update
      updateClock();
    }

    // Function to update the clock
    function updateClock() {
      const now = new Date();
      let hours = now.getHours().toString().padStart(2, '0');
      let minutes = now.getMinutes().toString().padStart(2, '0');
      let seconds = now.getSeconds().toString().padStart(2, '0');

      document.getElementById('current-time').textContent = `${hours}:${minutes}:${seconds}`;

      // 檢查服務是否運行
      updateServiceStatus(hours, minutes);

      // 當分鐘變化時，檢查是否需要切換路線
      if (seconds === '00') {
        loadRouteBasedOnTime();
      }
    }

    // Function to check if service is running
    function updateServiceStatus(hours, minutes) {
      const timeString = `${hours}:${minutes}`;
      const config = routeConfig[currentRoute];
      const [startTime, endTime] = config.operatingHours.split('-');

      // Convert time strings to minutes for comparison
      const currentMinutes = parseInt(hours) * 60 + parseInt(minutes);
      const startMinutes = parseInt(startTime.split(':')[0]) * 60 + parseInt(startTime.split(':')[1]);
      const endMinutes = parseInt(endTime.split(':')[0]) * 60 + parseInt(endTime.split(':')[1]);

      const isServiceRunning = currentMinutes >= startMinutes && currentMinutes <= endMinutes;

      // Update the current schedule row
      updateCurrentScheduleRow(timeString);
    }

    // Function to load a route
    function loadRoute(routeName) {
      currentRoute = routeName;
      const config = routeConfig[routeName];

      // Update route description
      // document.getElementById('route-description').innerHTML = `<b>${config.name}:</b> ${config.description}`;

      // Update frequency
      document.getElementById('frequency').textContent = config.busFrequency;

      // Update service times
      const serviceTimesContainer = document.getElementById('service-times');
      if (config.buses === 1) {
        serviceTimesContainer.innerHTML = `<div>Bus: ${config.operatingHours}</div>`;
      } else {
        serviceTimesContainer.innerHTML = '';
        for (let i = 1; i <= config.buses; i++) {
          serviceTimesContainer.innerHTML += `<div>Bus ${i}: ${config.operatingHours}</div>`;
        }
      }

      // Update last bus times
      const lastBusTimesContainer = document.getElementById('last-bus-times');
      if (typeof config.lastBus === 'string') {
        lastBusTimesContainer.innerHTML = `<div class="text-danger">Last bus: ${config.lastBus}</div>`;
      } else {
        lastBusTimesContainer.innerHTML = '';
        Object.entries(config.lastBus).forEach(([key, value]) => {
          const busNumber = key.replace('bus', '');
          lastBusTimesContainer.innerHTML += `<div class="text-danger">Bus ${busNumber}: ${value}</div>`;
        });
      }

      // Update schedule title
      document.getElementById('schedule-title').textContent = config.name;

      // Generate stops display
      generateStopsDisplay(config.stops);

      // Generate schedule table
      generateScheduleTable(config);
    }

    // Function to generate stops display
    function generateStopsDisplay(stops) {
      const stopsContainer = document.getElementById('stops-container');
      stopsContainer.innerHTML = '';

      stops.forEach((stop, index) => {
        const isLastStop = index === stops.length - 1;

        const stationContainer = document.createElement('div');
        stationContainer.className = 'station-container';

        // Create station marker and name
        const stationMarkerDiv = document.createElement('div');
        stationMarkerDiv.className = 'd-flex align-items-center';

        const markerDiv = document.createElement('div');
        markerDiv.className = 'station-marker me-2';

        // First station has a triangle icon
        if (index === 0) {
          const icon = document.createElement('i');
          icon.className = 'bi bi-triangle-fill rotate180';
          markerDiv.appendChild(icon);
        }

        const stationNameDiv = document.createElement('div');
        stationNameDiv.innerHTML = stop.includes(' ') ? stop.replace(' ', '<br>') : stop;

        stationMarkerDiv.appendChild(markerDiv);
        stationMarkerDiv.appendChild(stationNameDiv);

        stationContainer.appendChild(stationMarkerDiv);

        // Add connector for all but the last stop
        if (!isLastStop) {
          const connectorDiv = document.createElement('div');
          connectorDiv.className = 'station-connector';
          stationContainer.appendChild(connectorDiv);
        }

        // Add bus icon placeholder (will be populated by simulation)
        const busIconPlaceholder = document.createElement('div');
        busIconPlaceholder.className = 'ms-5';
        busIconPlaceholder.id = `bus-placeholder-${index}`;
        stationContainer.appendChild(busIconPlaceholder);

        stopsContainer.appendChild(stationContainer);
      });
    }

    // Function to generate schedule table
    function generateScheduleTable(config) {
      // Generate header
      const headerRow = document.getElementById('schedule-header');
      headerRow.innerHTML = '';

      // Add Bus column if there are multiple buses
      if (config.buses > 1) {
        const busHeaderCell = document.createElement('th');
        busHeaderCell.textContent = 'Bus';
        headerRow.appendChild(busHeaderCell);
      }

      // Add each stop as a column
      config.stops.forEach(stop => {
        const stopHeaderCell = document.createElement('th');
        stopHeaderCell.textContent = stop;
        headerRow.appendChild(stopHeaderCell);
      });

      // Generate schedule body
      const scheduleBody = document.getElementById('schedule-body');
      scheduleBody.innerHTML = '';

      config.schedule.forEach(schedule => {
        const row = document.createElement('tr');
        row.id = `schedule-row-${schedule.id}${config.buses > 1 ? '-bus' + schedule.bus : ''}`;

        // Add Bus column if there are multiple buses
        if (config.buses > 1) {
          const busCell = document.createElement('td');
          busCell.textContent = schedule.bus;
          row.appendChild(busCell);
        }

        // Add time for each stop
        schedule.times.forEach(time => {
          const timeCell = document.createElement('td');
          timeCell.textContent = time;
          row.appendChild(timeCell);
        });

        scheduleBody.appendChild(row);
      });
    }

    // Function to update the current schedule row
    function updateCurrentScheduleRow(currentTime) {
      const config = routeConfig[currentRoute];
      const scheduleRows = document.querySelectorAll('#schedule-body tr');
      
      // 首先，取消所有行的高亮
      scheduleRows.forEach(row => {
        row.classList.remove('table-success');
      });
      
      // 轉換當前時間為分鐘
      const currentTimeMinutes = timeToMinutes(currentTime);
      
      // 找到下一個即將到來的時間段
      let nextScheduleIndex = -1;
      let smallestDifference = Infinity;
      
      config.schedule.forEach((schedule, index) => {
        // 獲取此行程第一站的時間
        const firstStopTimeMinutes = timeToMinutes(schedule.times[0]);
        
        // 計算與當前時間的差距
        const timeDifference = firstStopTimeMinutes - currentTimeMinutes;
        
        // 如果時間已過，但差距最小，或者是即將來臨的最近時間
        if ((timeDifference <= 0 && timeDifference > -30) || (timeDifference > 0 && timeDifference < smallestDifference)) {
          smallestDifference = Math.abs(timeDifference);
          nextScheduleIndex = index;
        }
      });
      
      // 如果找到了合適的行程，高亮顯示
      if (nextScheduleIndex !== -1) {
        const schedule = config.schedule[nextScheduleIndex];
        const busStr = config.buses > 1 ? `-bus${schedule.bus}` : '';
        const rowId = `schedule-row-${schedule.id}${busStr}`;
        const row = document.getElementById(rowId);
        
        if (row) {
          row.classList.add('table-success');
        }
        
        // 繼續更新巴士位置
        updateBusPositions(currentTime, schedule);
      }
    }

    // Function to check if time is in range
    function isTimeInRange(currentTime, startTime, endTime) {
      // Convert all times to minutes for comparison
      const currentMinutes = timeToMinutes(currentTime);
      const startMinutes = timeToMinutes(startTime);
      const endMinutes = timeToMinutes(endTime);

      return currentMinutes >= startMinutes && currentMinutes <= endMinutes;
    }

    // Helper function to convert time string to minutes
    function timeToMinutes(timeStr) {
      const [hours, minutes] = timeStr.split(':').map(num => parseInt(num));
      return hours * 60 + minutes;
    }

    // Function to update bus positions
    function updateBusPositions(currentTime, currentSchedule) {
      // Clear all bus placeholders
      const placeholders = document.querySelectorAll('[id^="bus-placeholder-"]');
      placeholders.forEach(placeholder => {
        placeholder.innerHTML = '';
      });

      if (!currentSchedule) return;

      const config = routeConfig[currentRoute];
      const currentTimeMinutes = timeToMinutes(currentTime);

      currentSchedule.times.forEach((stopTime, stopIndex) => {
        const stopTimeMinutes = timeToMinutes(stopTime);
        const timeDiff = stopTimeMinutes - currentTimeMinutes;

        // If within 2 minutes before this stop time
        if (timeDiff >= -2 && timeDiff <= 0) {
          // Show bus at this stop with passenger icon
          const placeholder = document.getElementById(`bus-placeholder-${stopIndex}`);
          if (placeholder) {
            placeholder.innerHTML = `
      <div class="bus-icon">
        <i class="bi bi-person-walking animated-blink"></i>
        <i class="bi bi-bus-front-fill"></i>
        <div class="bus-number">${currentSchedule.bus || 1}</div>
      </div>
    `;
          }
        }
        // If just passed this stop but not yet at the next stop
        else if (timeDiff < 0 && stopIndex < currentSchedule.times.length - 1) {
          const nextStopTime = currentSchedule.times[stopIndex + 1];
          const nextStopMinutes = timeToMinutes(nextStopTime);

          // If we're heading to the next stop but not there yet
          if (currentTimeMinutes < nextStopMinutes) {
            const placeholder = document.getElementById(`bus-placeholder-${stopIndex}`);
            if (placeholder) {
              placeholder.innerHTML = `
        <div class="bus-icon">
          <i class="bi bi-chevron-double-down animated-hover"></i>
          <i class="bi bi-bus-front-fill"></i>
          <div class="bus-number">${currentSchedule.bus || 1}</div>
        </div>
      `;
            }
          }
        }

        // If at the last stop and just completed the route
        if (stopIndex === config.stops.length - 1 && timeDiff < 0) {
          const placeholder = document.getElementById(`bus-placeholder-${stopIndex}`);
          if (placeholder) {
            placeholder.innerHTML = `
      <div class="bus-icon">
        <div width="32px" height="32px">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 500 625" style="enable-background:new 0 0 500 500;fill:#92BA79;" width="32px" height="32px" xml:space="preserve"><path d="M468.5,162.1L370,63.5c-4.7-4.7-11-7.3-17.7-7.3s-13,2.6-17.7,7.3l-98.5,98.5c-9.8,9.8-9.8,25.6,0,35.4  c9.8,9.8,25.6,9.8,35.4,0l55.8-55.8v125.6c0,69.7-56.7,126.5-126.5,126.5S74.2,337,74.2,267.3v-111c0-13.8-11.2-25-25-25  s-25,11.2-25,25v111c0,97.3,79.2,176.5,176.5,176.5c97.3,0,176.5-79.2,176.5-176.5V141.5l55.9,55.9c4.9,4.9,11.3,7.3,17.7,7.3  c6.4,0,12.8-2.4,17.7-7.3C478.2,187.7,478.2,171.8,468.5,162.1z"/></svg>
        </div>
        <i class="bi bi-bus-front-fill"></i>
        <div class="bus-number">${currentSchedule.bus || 1}</div>
      </div>
    `;
          }
        }
      });
    }

    // Function to simulate bus movement
    function simulateBusMovement() {
      // This is just a wrapper around updateClock, which already handles the bus movement simulation
      // The simulation is based on the current time, so we don't need additional logic here
      console.log("Bus simulation started");
    }
  </script>
</body>

</html>